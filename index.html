<!DOCTYPE html>
<html lang="en">
<style>
#notes{
    display: flex;
    flex-direction:column;
    border: 1px solid #ccc;
    flex-direction: column;
    display: none;
}
#notes>div{
    border: 1px #e2e2e2 solid;
}
.top{
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.top div{
    line-height: 23px;
    background: #eaeaea;
    padding: 10px;      
}


.bottom{
    
}
#new {
    position: fixed;
    right: 20px;
    top: 20px;
    height: 40px;
    width: 40px;
    background: #eee;
    border-radius: 20px;
    line-height: 40px;
    font-weight: 900;
    font-size: 40px;
    text-align: center;
    color: #6b6b6b;
    transition: all 0.3s;
}

#new:hover {
    color: #000;
    background: #f5f5f5;
    cursor: pointer;
}
</style>

<head>
    <meta charset="UTF-8">
    <title>操作笔记</title>
</head>

<body>
    <canvas id="canvas" width="100" height="30"></canvas>
    <div class="render">
        <p>净收益： <span id="total"></span>元</p>
        <p>平均每次操作收益： <span id="avg"></span>元</p>
    </div>
    <div id='new'>+</div>
    <div id="notes">
        <div class="top">
            <div id="time"></div>
            <div id="operation"></div>
            <div id="id"></div>
            <div id="name"></div>
            <div id="price"></div>
            <div id="amount"></div>
        </div>
        <div id="memo" class="bottom"></div>
    </div>
    <script src="./temp/data"></script>
    <script src="./temp/notes"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
    <script>
    'use strict';

    let timeline = [],
        price = [],
        bgColor = [];

    for (let i in data) {
        timeline.push(i);
        price.push(data[i]);
        bgColor.push(data[i] > 0 ? 'red' : 'green');
    }

    let total = price.reduce((p, n) => p + n),
        avg = (total / price.length).toFixed(2)

    let barChartData = {
        labels: timeline,
        datasets: [{
            label: '金额',
            backgroundColor: bgColor,
            borderColor: '#fff',
            borderWidth: 1,
            data: price
        }]
    };

    function showMemo(index){
        if(document.getElementById('notes').style.display === '')
            document.getElementById('notes').style.display = 'block'

        for(let i in notes){
            if(timeline[index] === notes[i].date){
                memo.innerHTML = notes[i].memo;
                time.innerHTML = notes[i].date +" "+notes[i].time;
                document.getElementById('id').innerHTML = notes[i].id;
                document.getElementById('name').innerHTML = notes[i].name;
                document.getElementById('price').innerHTML = "价格: "+notes[i].price;
                amount.innerHTML = "数量: "+notes[i].amount;
                operation.innerHTML = notes[i].operation;
                return;
            }
        }
    }

    window.onload = function() {
        var ctx = document.getElementById("canvas").getContext("2d");

        //生成图表
        Chart.defaults.global.defaultFontSize = 16;
        Chart.defaults.global.hover.intersect = true;
        let myChart = new Chart(ctx, {
            type: 'bar',
            data: barChartData,
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: '操作损益表'
                }
            }
        });

        //监听图形单击，显示操作记录
        canvas.onclick = function(e){
            var item = myChart.getElementAtEvent(e)[0];

            if (item) {
                showMemo(item._index);
            }
        };

         document.getElementById('new').onclick = function() {
            console.log(1)
        }

        document.getElementById("total").innerHTML = total;
        document.getElementById("avg").innerHTML = avg;

    };
    </script>
</body>

</html>